#include "xm_i2c.h"
#include "xm_print.h"
#include "xm_sns_ctrl.h"
#include "xm_type.h"

extern void SysDelay_ms(XM_S32 ms);

static const XM_U16 gau16SnsInit_apollo[][2] = {
    // 37.125M   74.25M
    {0x0100, 0x00},
    {0x3641, 0x0c},
    {0x36e9, 0x24},
    {0x36ea, 0x3a},
    {0x36eb, 0x16},
    {0x36ec, 0x17},
    {0x36ed, 0x14},
    {0x36f9, 0x24},
    {0x36fa, 0x3a},
    {0x36fb, 0x15},
    {0x36fc, 0x10},
    {0x36fd, 0x14},
    {0x3641, 0x00},
    {0x3208, 0x07},
    {0x3209, 0x80},
    {0x320c, 0x08},
    {0x320d, 0x98},
    {0x320e, 0x08},
    {0x320f, 0xca},
    {0x3211, 0x08},
    {0x3241, 0x00},
    {0x3243, 0x03},
    {0x3248, 0x00},
    {0x3271, 0x1c},
    {0x3273, 0x1f},
    {0x3301, 0x30},
    {0x3306, 0xa8},
    {0x3309, 0x40},
    {0x330b, 0x68},
    {0x330e, 0x60},
    {0x3314, 0x94},
    {0x331f, 0x31},
    {0x334c, 0x10},
    {0x335d, 0x60},
    {0x3366, 0x92},
    {0x3367, 0x08},
    {0x3368, 0x07},
    {0x3369, 0x00},
    {0x336a, 0x00},
    {0x336b, 0x00},
    {0x336c, 0xc2},
    {0x337f, 0x33},
    {0x33af, 0x24},
    {0x33e0, 0xa0},
    {0x33e1, 0x08},
    {0x33e2, 0x18},
    {0x33e3, 0x10},
    {0x33e4, 0x0c},
    {0x33e5, 0x10},
    {0x33e6, 0x06},
    {0x33e7, 0x02},
    {0x33e8, 0x18},
    {0x33e9, 0x10},
    {0x33ea, 0x0c},
    {0x33eb, 0x10},
    {0x33ec, 0x04},
    {0x33ed, 0x02},
    {0x33ee, 0xa0},
    {0x33ef, 0x08},
    {0x33f4, 0x18},
    {0x33f5, 0x10},
    {0x33f6, 0x0c},
    {0x33f7, 0x10},
    {0x33f8, 0x06},
    {0x33f9, 0x02},
    {0x33fa, 0x18},
    {0x33fb, 0x10},
    {0x33fc, 0x0c},
    {0x33fd, 0x10},
    {0x33fe, 0x04},
    {0x33ff, 0x02},
    {0x360f, 0x01},
    {0x3622, 0xf7},
    {0x3624, 0x45},
    {0x3628, 0x83},
    {0x3630, 0x80},
    {0x3631, 0x80},
    {0x3632, 0x08},
    {0x3633, 0x22},
    {0x3635, 0x20},
    {0x3637, 0x29},
    {0x3638, 0x08},
    {0x363a, 0x88},
    {0x363b, 0x08},
    {0x363d, 0x01},
    {0x363e, 0x00},
    {0x3670, 0x48},
    {0x3671, 0xf7},
    {0x3672, 0x17},
    {0x3673, 0x17},
    {0x3674, 0x80},
    {0x3675, 0x85},
    {0x3676, 0xa5},
    {0x367a, 0x48},
    {0x367b, 0x78},
    {0x367c, 0x48},
    {0x367d, 0x78},
    {0x3690, 0x22},
    {0x3691, 0x33},
    {0x3692, 0x44},
    {0x3699, 0x88},
    {0x369a, 0x9f},
    {0x369b, 0x9f},
    {0x369c, 0x48},
    {0x369d, 0x78},
    {0x36a2, 0x48},
    {0x36a3, 0x78},
    {0x36bb, 0x48},
    {0x36bc, 0x78},
    {0x36c9, 0x01},
    {0x36ca, 0x20},
    {0x36cb, 0x20},
    {0x36cc, 0x00},
    {0x36cd, 0x10},
    {0x36ce, 0x1a},
    {0x36d0, 0x30},
    {0x36d1, 0x48},
    {0x36d2, 0x78},
    {0x3901, 0x08},
    {0x3907, 0x01},
    {0x3908, 0x11},
    {0x394c, 0x0f},
    {0x394d, 0x20},
    {0x394e, 0x08},
    {0x394f, 0x90},
    {0x3980, 0x71},
    {0x3981, 0x70},
    {0x3982, 0x00},
    {0x3983, 0x00},
    {0x3984, 0x20},
    {0x3990, 0x03},
    {0x3991, 0xfd},
    {0x3992, 0x03},
    {0x3993, 0xf8},
    {0x3994, 0x03},
    {0x3995, 0xfd},
    {0x3996, 0x03},
    {0x3997, 0xff},
    {0x3998, 0x00},
    {0x3999, 0x02},
    {0x399a, 0x00},
    {0x399b, 0x09},
    {0x399c, 0x00},
    {0x399d, 0x0c},
    {0x399e, 0x00},
    {0x399f, 0x0c},
    {0x39a0, 0x00},
    {0x39a1, 0x08},
    {0x39a2, 0x03},
    {0x39a3, 0xe3},
    {0x39a4, 0x03},
    {0x39a5, 0xee},
    {0x39a6, 0x03},
    {0x39a7, 0xf4},
    {0x39a8, 0x03},
    {0x39a9, 0xf8},
    {0x39aa, 0x03},
    {0x39ab, 0xfd},
    {0x39ac, 0x00},
    {0x39ad, 0x04},
    {0x39ae, 0x00},
    {0x39af, 0x09},
    {0x39b0, 0x00},
    {0x39b1, 0x0e},
    {0x39b2, 0x00},
    {0x39b3, 0x20},
    {0x39b4, 0x0c},
    {0x39b5, 0x1c},
    {0x39b6, 0x38},
    {0x39b7, 0x5b},
    {0x39b8, 0x50},
    {0x39b9, 0x38},
    {0x39ba, 0x20},
    {0x39bb, 0x10},
    {0x39bc, 0x0c},
    {0x39bd, 0x16},
    {0x39be, 0x21},
    {0x39bf, 0x36},
    {0x39c0, 0x3b},
    {0x39c1, 0x2a},
    {0x39c2, 0x16},
    {0x39c3, 0x0c},
    {0x39c5, 0x30},
    {0x39c6, 0x07},
    {0x39c7, 0xf8},
    {0x39c9, 0x07},
    {0x39ca, 0xf8},
    {0x39cc, 0x00},
    {0x39cd, 0x34},
    {0x39ce, 0x00},
    {0x39cf, 0x00},
    {0x39d0, 0x34},
    {0x39d1, 0x00},
    {0x39e2, 0x15},
    {0x39e3, 0x4d},
    {0x39e4, 0x15},
    {0x39e5, 0xbb},
    {0x39e6, 0x00},
    {0x39e7, 0x2f},
    {0x39e8, 0x00},
    {0x39e9, 0x1b},
    {0x39ea, 0x01},
    {0x39eb, 0x7a},
    {0x39ec, 0x08},
    {0x39ed, 0x00},
    {0x3e00, 0x01},
    {0x3e01, 0x18},
    {0x3e02, 0xa0},
    {0x3e03, 0x0b},
    {0x3e06, 0x00},
    {0x3e07, 0x80},
    {0x3e08, 0x03},
    {0x3e09, 0x40},
    {0x3e0e, 0x09},
    {0x3e16, 0x00},
    {0x3e17, 0xac},
    {0x3e18, 0x00},
    {0x3e19, 0xac},
    {0x3e1b, 0x3a},
    {0x3e1e, 0x76},
    {0x3e25, 0x23},
    {0x3e26, 0x40},
    {0x4837, 0x6c},
    {0x5000, 0x46},
    {0x5799, 0x06},
    {0x57aa, 0x2f},
    {0x57ab, 0xff},
    {0x5900, 0xf1},
    {0x5901, 0x04},

    {0x391B, 0x85}, // 黑电平闪
    // binning 叠加模式
    {0x5900, 0xf0},
    {0x3907, 0x00},
    {0x3908, 0x88},

    {0x0100, 0x01},
};

void sensor_init_apollo(void) {
  XM_U16 u16Num, u16i;
  u16Num = sizeof(gau16SnsInit_apollo) / sizeof(gau16SnsInit_apollo[0]);
  sensor_write_register(
      (XM_U32)gau16SnsInit_apollo[0][0],
      (XM_U32)gau16SnsInit_apollo[0][1]); // reset all registers
  SysDelay_ms(10);
  for (u16i = 1; u16i < u16Num; u16i++) {
    sensor_write_register((XM_U32)gau16SnsInit_apollo[u16i][0],
                          (XM_U32)gau16SnsInit_apollo[u16i][1]);
  }
  DEBUG("------------- apollo 4K 15fps init ok! (@20181221)----------------\n");
}
