#include "xm_i2c.h"
#include "xm_print.h"
#include "xm_sns_ctrl.h"
#include "xm_type.h"
extern void SysDelay_ms(XM_S32 ms);

static const XM_U16 gau16SnsInit_sc5239[][2] = {
    // ExtClk: 18M -> 117M
    // @20180202
    {0x0100, 0x00}, {0x3001, 0xfe}, {0x3018, 0x33}, {0x301c, 0x78},
    {0x3031, 0x0a}, {0x3037, 0x20}, {0x3038, 0xcc}, {0x303f, 0x01},
    {0x3202, 0x00}, {0x3203, 0x22}, {0x3206, 0x05}, {0x3207, 0xd7},
    {0x320a, 0x05}, {0x320b, 0xb0}, {0x320c, 0x0a}, {0x320d, 0x28},
    {0x320e, 0x05}, {0x320f, 0xdc}, {0x3222, 0x29}, {0x3235, 0x0b},
    {0x3236, 0xb0}, {0x3301, 0x1e}, {0x3303, 0x30}, {0x3306, 0x60},
    {0x3307, 0x18}, {0x3308, 0x18}, {0x3309, 0x80}, {0x330a, 0x01},
    {0x330b, 0x10}, {0x330e, 0x50}, {0x330f, 0x04}, {0x3310, 0x20},
    {0x3314, 0x04}, {0x331e, 0x21}, {0x331f, 0x71}, {0x3320, 0x06},
    {0x3326, 0x00}, {0x3333, 0x20}, {0x3366, 0x78}, {0x3367, 0x08},
    {0x3368, 0x04}, {0x3369, 0x00}, {0x336a, 0x00}, {0x336b, 0x00},
    {0x337f, 0x03}, {0x33aa, 0x00}, {0x3620, 0x28}, {0x3622, 0xf6},
    {0x3625, 0x03}, {0x3630, 0x80}, {0x3631, 0x88}, {0x3632, 0x18},
    {0x3633, 0x23}, {0x3635, 0xe2}, {0x3636, 0x24}, {0x3637, 0x63},
    {0x3638, 0x18}, {0x3639, 0x09}, {0x363a, 0x1f}, {0x363b, 0x0c},
    {0x363c, 0x05}, {0x363d, 0x05}, {0x3640, 0x02}, {0x3641, 0x02},
    {0x3650, 0x42}, {0x366e, 0x08}, {0x366f, 0x2f}, {0x36e9, 0x24},
    {0x36ea, 0x33}, {0x36eb, 0x0e}, {0x36ec, 0x1e}, {0x36ed, 0x23},
    {0x36f9, 0x04}, {0x36fa, 0xca}, {0x3802, 0x01}, {0x3901, 0x02},
    {0x3908, 0x15}, {0x3933, 0x0a}, {0x3934, 0x08}, {0x3940, 0x19},
    {0x3941, 0x14}, {0x3942, 0x02}, {0x3943, 0x0d}, {0x3946, 0x20},
    {0x3947, 0x18}, {0x3948, 0x06}, {0x3949, 0x06}, {0x394a, 0x18},
    {0x394b, 0x2c}, {0x394c, 0x08}, {0x394d, 0x14}, {0x394e, 0x24},
    {0x394f, 0x34}, {0x3950, 0x14}, {0x3951, 0x08}, {0x3952, 0x78},
    {0x3953, 0x48}, {0x3954, 0x18}, {0x3955, 0x18}, {0x3956, 0x48},
    {0x3957, 0x80}, {0x3958, 0x10}, {0x3959, 0x20}, {0x395a, 0x38},
    {0x395b, 0x38}, {0x395c, 0x20}, {0x395d, 0x10}, {0x395e, 0x24},
    {0x395f, 0x00}, {0x3960, 0xc4}, {0x3961, 0xb1}, {0x3962, 0x0d},
    {0x3963, 0x80}, {0x3e01, 0xbb}, {0x3e02, 0x60}, {0x3e06, 0x00},
    {0x3e08, 0x03}, {0x3e09, 0x10}, {0x3e1e, 0x34}, {0x3f00, 0x0f},
    {0x3f04, 0x05}, {0x3f05, 0x00}, {0x4603, 0x00}, {0x4827, 0x46},
    {0x4837, 0x20}, {0x5784, 0x10}, {0x5788, 0x10},
#if 0
	{0x5780,0xFF},	// DPC Manual
#else // AutoDpc
    {0x5780, 0x7f}, // auto dpc
    {0x5781, 0x04}, // white 1x
    {0x5782, 0x03}, // 1x~4x
    {0x5783, 0x02}, // 4x~8x
    {0x5784, 0x01}, // 8x~128x
    {0x5785, 0x18}, // black 1x
    {0x5786, 0x10}, // 1x~4x
    {0x5787, 0x08}, // 4x~8x
    {0x5788, 0x02}, // 8x~128x
    {0x5789, 0x20}, // gain0=4x 低4位表示
                    // a_fine_gain，高4位表示2^n(不考虑d_fine_gain)
    {0x578a, 0x30}, // gain1=8x 2^3=8x,a_fine_gain=0x10,即={0x0f10}=8x
#endif
    {0x3946, 0x00}, {0x3947, 0x00}, {0x3948, 0x00}, {0x3949, 0x00},
    {0x394A, 0x00}, {0x394B, 0x00},

    {0x3952, 0x10}, {0x3953, 0x10}, {0x3954, 0x08}, {0x3955, 0x08},
    {0x3956, 0x10}, {0x3957, 0x14}, {0x3958, 0x0a}, {0x3959, 0x10},
    {0x395a, 0x18}, {0x395b, 0x18}, {0x395c, 0x10}, {0x395d, 0x0a},
    {0x3962, 0x0d}, {0x0100, 0x01}};

void sensor_init_sc5239(void) {
  XM_U16 u16Num, u16i;
  u16Num = sizeof(gau16SnsInit_sc5239) / sizeof(gau16SnsInit_sc5239[0]);
  sensor_write_register(
      (XM_U32)gau16SnsInit_sc5239[0][0],
      (XM_U32)gau16SnsInit_sc5239[0][1]); // reset all registers
  SysDelay_ms(50);
  for (u16i = 1; u16i < u16Num; u16i++) {
    sensor_write_register((XM_U32)gau16SnsInit_sc5239[u16i][0],
                          (XM_U32)gau16SnsInit_sc5239[u16i][1]);
  }
  DEBUG("------------- SC5239 4M 15fps  init ok! "
        "(@201801225_158x4)----------------\n");
}
